依赖注入是一个过程，就是当一个类需要调用另一个类来完成某项任务的时候，在调用类里面不要去new被调用的类的对象，而是通过注入的方式来获取这样一个对象。具体的实现就是在调用类里面有一个被调用类的接口，然后通过调用接口的函数来完成任务。
## 使用DI步骤：
1.Install- Package Microsoft.Extensions.DependencyInjection
2.using Microsoft.Extensions.DependencyInjection
3.ServiceCollention用来构造容器对象IServiceProvider。调用Servicecollection的BuildServiceProvider()创建的ServiceProvider,可以用来获取BuildServiceProvider（）之前。
```
        //创建ServiceCollection实例
        ServiceCollection serviceCollection = new ServiceCollection();
        //注册服务
        serviceCollection.AddTransient<Itext, TestServiceImpl>();
        //构建依赖注入容器
        using (ServiceProvider serviceProvider =serviceCollection.BuildServiceProvider())
        {
            //从容器中获取服务实例
          TestServiceImpl t =   serviceProvider.GetService<TestServiceImpl>();
          t.Name = "Tom";
          t.SatHi();
        }
```
1.如果一个类实现IDisposable接口，离开作用域后容器会自动调用对象的Disposable方法。
2.不要在长生命周期的对象中引用比它短的生命周期对象
### 生命周期：
1.瞬时生命周期:表示每次请求都创建一个新的实例
2.作用域生命周期：表示在同一个作用域内共享同一个实例
3.单例生命周期:表示整个应用程序共享同一个实例
```
services.AddTransient<IMyService, MyService>(); // 瞬时生命周期
services.AddScoped<IMyService, MyService>(); // 作用域生命周期
services.AddSingleton<IMyService, MyService>(); // 单例生命周期
```

## IServiceProvider的服务定位器方法：
1.T GetService<T>()如果获取不到对象，则返回null;
```
TestServiceImpl impl=serviceProvider.GetService<TestServiceImpl>();
```
2.  object GetService(Type serviceType)
```
  TestServiceImpl impl1 =(TestServiceImpl)serviceProvider.GetService(typeof(TestServiceImpl));
```
3.T GetRequiredService(Type serviceType) ，如果获取不到对象，则抛异常
```
TestServiceImpl imp2=serviceProvider.GetRequiredService<TestServiceImpl>();
```
## 属性注入
需要进行属性注入的属性上添加 [Inject] 特性
```
public class MyClass
{
    [Inject]
    public IMyDependency MyDependency { get; set; }

    public void DoWork()
    {
        MyDependency.DoSomething();
    }
}
```
MyClass 类具有一个标记了 [Inject] 特性的属性 MyDependency，表示它需要依赖于 IMyDependency 接口。通过使用依赖注入容器，我们可以解析 MyClass 的实例并自动注入 MyDependency 属性的实例。

## 模块化注入
模块类需要实现 IModule 接口,接口定义了一个方法 ConfigureServices，用于注册服务。
```
using Microsoft.Extensions.DependencyInjection;

public class MyModule : IModule
{
    public void ConfigureServices(IServiceCollection services)
    {
        // 在这里注册服务
        services.AddTransient<IMyService, MyService>();
        services.AddScoped<IOtherService, OtherService>();
        // ...
    }
}
```
